<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report</title>
  <link rel="icon" type="image/png" href="panther.png">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Container spacing */
.report-container {
  max-width: 600px;
  margin: 40px auto; /* centers and adds top/bottom space */
  padding: 30px;
  background: #fdf4e3; /* softer beige */
  border-radius: 10px;
  box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
}

/* Headings */
.report-container h2 {
  margin-bottom: 20px;
  font-size: 1.8em;
}

/* Labels and inputs */
form label {
  display: block;
  margin-top: 15px;
  font-weight: bold;
}

form select,
form input,
form textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1em;
}

/* Textarea bigger */
form textarea {
  resize: vertical;
}

/* Submit buttons */
form button {
  margin-top: 20px;
  width: 100%;
  background: #004700;
  color: white;
  padding: 12px;
  border: none;
  border-radius: 6px;
  font-size: 1.1em;
  cursor: pointer;
}

form button:hover {
  background: #006600;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.tab-button {
  flex: 1;
  padding: 12px;
  font-size: 1em;
}

  </style>
</head>
<body>
  <header>
    <!--img src="nub.png" height="50" alt="HandiMapped Logo" justify-content="flex-start"/ I'm giving up - margo-->
    <h1>Report</h1>
    <nav class="navbar">
      <div class="navbar-content">
      <ul class="menu">
        <li class="item"><a href="index.html">Home</a></li>
        <li class="item"><a href="profile.html">Profile</a></li>
        <li class="item"><a href="about.html">About Us</a></li>
      </ul>
      
      <a href="https://steelhacks.org/" target="_blank">
        <button>SteelHacks XII</button>
      </a>
      </div>
    </nav>
  </header>

  <div class="report-container">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-button active" onclick="showTab(event, 'reportForm')">Submit Report</button>
      <button class="tab-button" onclick="showTab(event, 'new-building')">Add New Building</button>
    </div>

    <!-- Report -->
    <div id="reportForm" class="tab-content active">
      <h2>Submit a Report</h2>
      <form id="reportForm">
        <label for="building">Building:</label>
        <select id="building" required>
          <option value="">-- Select a building --</option>
        </select>

        <label for="stars">Rating (1–5):</label>
        <select id="stars" required>
          <option value="1">⭐ 1</option>
          <option value="2">⭐ 2</option>
          <option value="3">⭐ 3</option>
          <option value="4">⭐ 4</option>
          <option value="5">⭐ 5</option>
        </select>

        <label for="review">Your Review:</label>
        <textarea id="review" rows="4"></textarea>

        <label for="name">Your Name:</label>
        <input type="text" id="name" placeholder="e.g., Amaya Papaya">

        <button class="tab-button" id="add-review" type="submit">Submit</button>
      </form>

      <div id="output" class="review-output" style="display:none;"></div>
    </div>

    <!-- New Building Form -->
    <div id="new-building" class="tab-content">
      <h2>Add a New Building</h2>
      <form id="buildingForm">
        <label for="newName">Building Name:</label>
        <input type="text" id="newName" required>

        <label for="address">Address:</label>
        <input type="text" id="address" required>

        <label for="function">Function (e.g., Academic / Library):</label>
        <input type="text" id="function" required>

        <label for="fire-data">Evacuation Information:</label>
        <input type="text" id="fire-data">

        <label for="accessibility">Accessibility Note:</label>
        <textarea type="text" id="accessibility" rows="4"></textarea>

        <button class="tab-button" id="add-building" type="submit">Add Building</button>
      </form>
    </div>
  </div>

  <script>
    loadBuildings();

    document.getElementById("reportForm").addEventListener("submit", function(event) {
      try {
        const building = document.getElementById("building").innerText;
        const stars = document.getElementById("stars").value;
        const review = document.getElementById("review").value;
        const name = document.getElementById("name").value || "Anonymous";

        if (building === "new") {

        }
        // Works on both localhost and Vercel
        const res = fetch('https://handimapped.com/api/conn?action=POSTREV', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            building: building,
            rating: parseDouble(stars),
            comment: review,
            name: name })
        });

        const data = res.json();

        if (!res.ok) {
          console.error('HTTP error', res.status);
          return;
        }

        const today = new Date().toLocaleDateString();

        let output = document.getElementById("output");
        output.style.display = "block";

        let reviewData = { building, stars, review, name, date: today };
        localStorage.setItem(building, JSON.stringify(reviewData));
        output.innerHTML = `
          <h3>Review Submitted</h3>
          <p><b>Building:</b> ${building}</p>
          <p><b>Rating:</b> ${"⭐".repeat(stars)}</p>
          <p><b>Review:</b> ${review}</p>
          <p><b>Submitted by:</b> ${name}</p>
          <p><b>Date:</b> ${today}</p>
        `;

      } catch (err) {
        console.error('Fetch failed', err);
      }

    });

    document.getElementById("buildingForm").addEventListener("submit", function(event) {
      try {
        const name = document.getElementById("newName").value;
        const address = document.getElementById("address").value;
        const func = document.getElementById("function").value;
        const fire_data = document.getElementById("fire-data").value;
        const accessibility = document.getElementById("accessibility").value;

        const lat = 0.0;
        const lng = 0.0;

        if (building === "new") {

        }
        // Works on both localhost and Vercel
        const res = fetch('https://handimapped.com/api/conn?action=POSTBUILD', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            name: name,
            address: address,
            func: func,
            fire: fire_data,
            acc: accessibility,
            lat: lat,
            lng: lng})
        });

        const data = res.json();

        if (!res.ok) {
          console.error('HTTP error', res.status);
          return;
        }

        const today = new Date().toLocaleDateString();

        let output = document.getElementById("output");
        output.style.display = "block";

        let reviewData = { name, address, func, date: today };
        localStorage.setItem(building, JSON.stringify(reviewData));
        output.innerHTML = `
          <h3>Building Submitted</h3>
          <p><b>Name:</b> ${name}</p>
          <p><b>Address:</b> ${address}</p>
          <p><b>Function:</b> ${func}</p>
          <p><b>Date:</b> ${today}</p>
        `;

      } catch (err) {
        console.error('Fetch failed', err);
      }

    }); 

    async function loadBuildings() {
      try {
        // Works on both localhost and Vercel
        const res = await fetch('https://handimapped.com/api/conn?action=GETBUILD');
        if (!res.ok) {
          console.error('HTTP error', res.status);
          return;
        }

        const buildings = await res.json();

        const select = document.getElementById("building");

        buildings.forEach(b => {
          const option = document.createElement("option");
          option.value = b.NAME;   // or b.CODE if you want numeric code
          option.textContent = b.NAME;
          select.appendChild(option);
        });
      } catch (err) {
        console.error('Fetch failed', err);
      }
    }

    function showTab(event, tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      // Remove "active" from all buttons
      document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
      // Show selected tab
      document.getElementById(tabId).classList.add('active');
      // Highlight the clicked button
      event.target.classList.add('active');
    }
  </script>
  <footer>
    <p>&copy; 2025 HandiMapped Team</p>
  </footer>
</body>
</html>
